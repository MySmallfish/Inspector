{"ts":1377970094692,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"(function(S){\n\tS.TimeReportManager = function(storageService){\n\t\t\n\t\t\n\t}\n\t\n})(Simple);"]],"start1":0,"start2":0,"length1":0,"length2":85}]],"length":85}
{"contributors":[],"silentsave":false,"ts":1377970233206,"patch":[[{"diffs":[[0,"unction("],[1,"$q, "],[0,"storageS"]],"start1":38,"start2":38,"length1":16,"length2":20},{"diffs":[[0,"){\n\t\t\n\t\t"],[1,"function reportTime(reportInfo){\n\t\t    var d = $q.defer();\n\t\t    d.resolve();\n\t\t    return d.promise;\n\t\t}\n\t\t\n\t\treturn {\n\t\t  report: reportTime  \n\t\t};"],[0,"\n\t}\n\t\n})"]],"start1":64,"start2":64,"length1":16,"length2":165}]],"length":238,"saved":false}
{"ts":1377970346588,"patch":[[{"diffs":[[0,"promise;"],[1,"\t\t    \n\t\t}\n\t\t\n\t\tfunction reportByCode(barCode){\n            return reportTime({});"],[0,"\n\t\t}\n\t\t\n"]],"start1":165,"start2":165,"length1":16,"length2":98},{"diffs":[[0,"  report"],[1,"ByCode"],[0,": report"]],"start1":276,"start2":276,"length1":16,"length2":22}]],"length":326,"saved":false}
{"ts":1377970361128,"patch":[[{"diffs":[[0,"portTime"],[-1,"  "],[1,",\n\t\t  report: reportTime"],[0,"\n\t\t};\n\t}"]],"start1":294,"start2":294,"length1":18,"length2":40}]],"length":348,"saved":false}
{"contributors":[],"silentsave":false,"ts":1377974409911,"patch":[[{"diffs":[[0,"resolve("],[1,"{ success: true, reportId: 1 }"],[0,");\n\t\t   "]],"start1":139,"start2":139,"length1":16,"length2":46}]],"length":378,"saved":false}
{"contributors":[],"silentsave":false,"ts":1378789107347,"patch":[[{"diffs":[[0,"ction(S)"],[1," "],[0,"{\n"],[-1,"\t"],[1,"    "],[0,"S.TimeRe"]],"start1":4,"start2":4,"length1":19,"length2":23},{"diffs":[[0,"function"],[1," "],[0,"($q, sto"]],"start1":41,"start2":41,"length1":16,"length2":17},{"diffs":[[0,"vice"],[-1,"){\n\t\t\n\t\tfunction reportTime(reportInfo){\n\t\t    var d = $q.defer();\n\t\t    d.resolve({ success: true, reportId: 1"],[1,", utils, geoLocation) {\n\n        function queue(item) {\n            return storageService.prefix(\"Inspector\").local(\"items\").then(function (items) {\n                items = items || [];\n                items.push(item);\n                return storageService.prefix(\"Inspector\").local(\"items\", items).then(function() {\n                    return item;\n                });\n            });\n        }\n\n        function store(item) {\n            return storageService.prefix(\"Inspector\").local(\"item-\" + item.UniqueId, item);\n        }\n        \n        function retrieve(uniqueId) {\n            return storageService.prefix(\"Inspector\").local(\"item-\" + uniqueId);\n        }\n        \n        function remove(uniqueId) {\n            return storageService.prefix(\"Inspector\").local(\"item-\" + uniqueId, null);\n        }\n\n        function approveTimeReport(uniqueId) {\n            return retrieve(uniqueId).then(function(item) {\n                return queue(item).then(function(queuedItem) {\n                    return remove(uniqueId).then(function() {\n                        return queuedItem;\n                    });\n                });\n            });\n        }\n\n        function getCurrentSite() {\n            return { Id: 2, Name: \"האתר הראשון\" };\n        }\n\n        function storeReportInfo(reportInfo) {\n            return store(reportInfo).then(function () {\n                return { success: true, reportId: reportInfo.UniqueId };\n           "],[0," });\n"],[-1,"\t\t"],[1,"   "],[0,"    "],[-1,"return d.promise;\t\t    \n\t\t}\n\t\t\n\t\t"],[1," }\n\n        var locationIsMandatory = false;\n        function reportTime(reportInfo) {\n            \n            reportInfo = angular.extend({\n                UniqueId: utils.guid.create(),\n                Date: new Date(),\n                Site: getCurrentSite()\n            }, reportInfo);\n\n            var promise = geoLocation.get().then(function (locationInfo) {\n                console.log(JSON.stringify(locationInfo));\n                alert(JSON.strinify(locationInfo));\n                reportInfo.Location = {};\n                return storeReportInfo(reportInfo);\n            }, function (error) {\n                console.log(\"ERROR\");\n                if (!locationIsMandatory) {\n                    return storeReportInfo(reportInfo);\n                } else {\n                    return { success: false, reportId: reportInfo.UniqueId };\n                }\n            });\n\n            return promise;\n        }\n\n        "],[0,"func"]],"start1":65,"start2":65,"length1":163,"length2":2391},{"diffs":[[0,"barCode)"],[1," "],[0,"{\n      "]],"start1":2474,"start2":2474,"length1":16,"length2":17},{"diffs":[[0,"me({"],[-1,"});\n\t\t}\n\t\t\n\t\treturn {\n\t\t"],[1," barCode: barCode });\n        }\n\n        return {\n          "],[0,"  re"]],"start1":2512,"start2":2512,"length1":32,"length2":68},{"diffs":[[0,"port"],[-1,"Time,\n\t\t"],[1,"ByCode,\n          "],[0,"  re"]],"start1":2594,"start2":2594,"length1":16,"length2":26},{"diffs":[[0,"Time"],[-1,"\n\t\t};\n\t}\n\t"],[1,",\n            approve: approveTimeReport,\n            get: retrieve\n        };\n    };\n"],[0,"\n})("]],"start1":2632,"start2":2632,"length1":18,"length2":94}]],"length":2734,"saved":false}
{"ts":1378789142135,"patch":[[{"diffs":[[0,"tion = {"],[1,"\n                    Longitude: locationInfo.longitude,\n                    Latitude: locationInfo.latitude\n                "],[0,"};\n     "]],"start1":2032,"start2":2032,"length1":16,"length2":140}]],"length":2858,"saved":false}
{"ts":1378789244008,"patch":[[{"diffs":[[0,"    "],[-1," console.log(JSON.stringify(locationInfo));\n                alert(JSON.strinify(locationInfo));"],[0,"\n   "]],"start1":1901,"start2":1901,"length1":103,"length2":8}]],"length":2763,"saved":false}
{"ts":1378789248199,"patch":[[{"diffs":[[0,") {\n"],[-1,"                console.log(\"ERROR\");\n"],[0,"    "]],"start1":2154,"start2":2154,"length1":46,"length2":8}]],"length":2725,"saved":false}
{"ts":1378789399857,"patch":[[{"diffs":[[0,"ion "],[-1,"queue("],[0,"item"],[1,"s("],[0,")"],[-1," "],[0,"{\n  "]],"start1":107,"start2":107,"length1":20,"length2":15},{"diffs":[[0,"\"items\")"],[1,";\n        }\n        function queue(item) {\n            return items()"],[0,".then(fu"]],"start1":180,"start2":180,"length1":16,"length2":85},{"diffs":[[0,"de });\n        }"],[1,"\n        \n        function getTimeReports(){\n            return \n        }"],[0,"\n\n        return"]],"start1":2586,"start2":2586,"length1":32,"length2":106}]],"length":2863,"saved":false}
{"ts":1378789415771,"patch":[[{"diffs":[[0," return "],[1,"items();"],[0,"\n       "]],"start1":2658,"start2":2658,"length1":16,"length2":24}]],"length":2871,"saved":false}
{"ts":1378789425030,"patch":[[{"diffs":[[0,"Report,\n"],[1,"            getTimeReports: getTimeReports\n"],[0,"        "]],"start1":2807,"start2":2807,"length1":16,"length2":59}]],"length":2914,"saved":false}
{"ts":1378789427313,"patch":[[{"diffs":[[0,"eReports"],[1,","],[0,"\n       "]],"start1":2849,"start2":2849,"length1":16,"length2":17}]],"length":2915,"saved":false}
